# K3s Deployment

For local testing a Lightweight Kubernetes cluster is used. [K3s](https://k3s.io/) is a lightweight Kubernetes distribution that is easy to install and manage. It is designed for resource-constrained environments and is ideal for local development and testing.

## Install K3s

```bash
curl -sfL https://get.k3s.io | sh - 
# Check for Ready node, takes ~30 seconds 
sudo k3s kubectl get node 
```

## Helm

Helm >=3.6 CLI is required to install MLRun. If you don't have it installed, you can do so with the following command:

```bash
curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
chmod 700 get_helm.sh
./get_helm.sh
```

## Test Kubernetes

```bash
sudo kubectl get nodes
```

## cert-manager

### Install cert-manager

```bash
# Apply the cert-manager manifest to install it
# This includes the CustomResourceDefinitions (CRDs) and the controller pods
sudo kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.14.5/cert-manager.yaml

# Verify the installation by checking the pods in the cert-manager namespace
# Wait until all pods are in the "Running" state
sudo kubectl get pods -n cert-manager
```

### Create a Cluster-Wide Certificate Authority

```bash
# Create a file named cluster-issuer.yaml
cat > cluster-issuer.yaml <<EOF
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned-ca
spec:
  selfSigned: {}
EOF

# Apply the issuer to the cluster
sudo kubectl apply -f cluster-issuer.yaml
```
